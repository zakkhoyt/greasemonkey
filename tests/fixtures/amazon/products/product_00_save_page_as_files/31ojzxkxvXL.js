'use strict';(function(e){var h=window.AmazonUIPageJS||window.P,t=h._namespace||h.attributeErrors,f=t?t("UdmRefreshAssets",""):h;f.guardFatal?f.guardFatal(e)(f,window):f.execute(function(){e(f,window)})})(function(e,h,t){e.when("A","udm-refresh-manager","quantity-dropdown-constants","udm-metrics-publisher","udm-amount-refresh").execute("quantity-dropdown-udm-refresh",function(f,c,a,n,d){function g(){p(a.SELECTORS.DELIVERY_BLOCK_AJAX_PARAMS).toArray().map(function(a){return k(a)}).forEach(function(a){return c.registerFeature(b,
{successHandler:l,failureHandler:m},a)})}function k(b){return b?Number(b.getAttribute(a.HTML_ATTRIBUTES.AUI_PAGE_STATE).match(a.REGEX.DELIVERY_BLOCK_AJAX_PARAMS)[1]):NaN}var p=f.$,b={featureName:a.FEATURE_REGISTRATION.NAME,featureAttribution:a.FEATURE_REGISTRATION.CTI,mandatoryParams:{quantity:"1"}},l=function(){n.logMetric(a.METRICS.QTY_REFRESH_SUCCESS)},m=function(){n.logMetric(a.METRICS.QTY_REFRESH_FAILURE)};f.on(a.EVENTS.PAGE_UPDATE,function(){g()});g();p(a.SELECTORS.QUANTITY_DROPDOWN).live("change",
function(b){try{if(!b.updateUdmOnQuantityChange){b.updateUdmOnQuantityChange=1;var f=p(this).val();b={quantity:f};var l;if(l=d.isEnabled){var u=this.closest("form")||this.closest("#buybox");if(u){var g=u.querySelector(a.SELECTORS.DIMENSION_INPUT);l=g&&g.value===a.DIMENSIONS.WEIGHT}else l=!1}l&&(b.amount=f,b.quantity="1");var q=p(this).closest(a.SELECTORS.ACCORDION_ROW),w=k(q.find(a.SELECTORS.DELIVERY_BLOCK_AJAX_PARAMS)[0]);isNaN(w)||c.refresh({featureName:a.FEATURE_REGISTRATION.NAME},b,w)}}catch(z){e.log("Quantity Dropdown UDM Refresh Failed with ERROR: "+
z,"ERROR","QuantityDropdown"),n.logMetric(a.METRICS.QTY_REFRESH_FAILURE)}})});"use strict";e.register("quantity-dropdown-constants",function(){return{FEATURE_REGISTRATION:{NAME:"QUANTITY",CTI:"Website/DEX Evaluation/Alternative Offer Eligibility Message"},EVENTS:{PAGE_UPDATE:"a:pageUpdate"},SELECTORS:{DELIVERY_BLOCK_AJAX_PARAMS:"script[data-a-state*\x3d'delivery-block-ajax-params']",ACCORDION_ROW:'\'[id$\x3d"AccordionRow"], #buybox, [id^\x3d"newAccordionRow"]\'',QUANTITY_DROPDOWN:"#selectQuantity [name\x3d'quantity'], #mobileQuantityDropDown",
DIMENSION_INPUT:'input[name\x3d"items[0.base][unitOfMeasureQuantity][unitOfMeasure][dimension]"]'},REGEX:{DELIVERY_BLOCK_AJAX_PARAMS:/delivery-block-ajax-params-(\d+)/},HTML_ATTRIBUTES:{AUI_PAGE_STATE:"data-a-state"},DIMENSIONS:{WEIGHT:"WEIGHT"},METRICS:{QTY_REFRESH_SUCCESS:"UDM-REFRESH-QUANTITY-SUCCESS",QTY_REFRESH_FAILURE:"UDM-REFRESH-QUANTITY-FAILURE"}}});"use strict";e.when("A").register("udm-refresh-allowlisted-features",function(f){var c={QUANTITY:{mandatoryParams:["quantity"],optionalParams:["amount"]},
SERVICE_OPTIONS:{mandatoryParams:["vas"]}};return{get:function(){return Object.keys(c)},getMandatoryParamsForFeature:function(a){return c[a].mandatoryParams},getOptionalParamsForFeature:function(a){return c[a].optionalParams||[]},getMandatoryParamsForAllFeatures:function(){var a=[];f.each(c,function(c){a=a.concat(c.mandatoryParams)});return a}}});"use strict";e.when("A","udm-refresh-allowlisted-features","udm-metrics-publisher").register("udm-refresh-feature-registration",function(f,c,a){function n(a){var b=
!0;f.each(c.getMandatoryParamsForFeature(a.featureName),function(c){a.mandatoryParams.hasOwnProperty(c)||(e.log("FeatureData is missing the mandatoryParam "+c,"ERROR",d(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),b=!1)});return b}function d(a){return a.featureName+" (C/T/I: "+a.featureAttribution+")"}function g(b,c){a.logMetric(b);a.logMetricWithSuffix(b,c)}var k={},p=["featureName","featureAttribution","mandatoryParams"];return{registerFeature:function(a,l,m){var b;a:{for(b=0;b<
p.length;b++){var h=p[b];if(!a.hasOwnProperty(h)){e.log("UDM Refresh Manager: Feature Registration does not contain valid mandatory attribute: "+h,"ERROR",a);g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName);b=!1;break a}}b=!0}if(!b)return!1;if(0>m)return e.log("UDM Refresh Manager: BuyingOptionIndex can not be less than 0","ERROR",d(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),!1;-1===c.get().indexOf(a.featureName)?(e.log("UDM Refresh Manager: Feature name is not allowlisted",
"ERROR",d(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),b=!1):b=!0;if(!b||!n(a))return!1;b=k.hasOwnProperty(m)&&k[m].hasOwnProperty(a.featureName)?!0:!1;if(b)return!1;l.hasOwnProperty("successHandler")&&l.hasOwnProperty("failureHandler")?"function"!==typeof l.successHandler||"function"!==typeof l.failureHandler?(e.log("UDM Refresh Manager: Callbacks are not of type function","ERROR",d(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),b=!1):b=!0:(e.log("UDM Refresh Manager: Functions missing in callbacks passed",
"ERROR",d(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),b=!1);if(!b)return!1;b={};h=a.featureName;l={featureName:a.featureName,featureAttribution:a.featureAttribution,callbacks:l,mandatoryParams:a.mandatoryParams,optionalParams:a.optionalParams};h in b?Object.defineProperty(b,h,{value:l,enumerable:!0,configurable:!0,writable:!0}):b[h]=l;k.hasOwnProperty(m)||(k[m]={});f.extend(k[m],b);g("UDM-FEATURE-REGISTRATION-REQUEST-SUCCESS",a.featureName);return!0},getDataForFeature:function(a,
c){return k.hasOwnProperty(c)&&k[c].hasOwnProperty(a)?k[c][a]:null},getRegisteredFeatures:function(a){return Object.keys(k[a])}}});"use strict";e.when("A","udm-refresh-framework").register("udm-refresh-manager",function(f,c){return{refresh:function(a,f,d){return c.refresh(a,f,d)},registerFeature:function(a,f,d){return c.registerFeature(a,f,d)}}});"use strict";e.when("A","udm-refresh-feature-registration","udm-gxa-handler","udm-refresh-dom-accessor","udm-refresh-allowlisted-features","udm-metrics-publisher",
"udm-glow-cip-migration-weblab").register("udm-refresh-framework",function(f,c,a,n,d,g,k){function h(a,c,b){if(!a.hasOwnProperty("featureName"))return e.log("UDM Refresh Manager: Feature data passed to UDM refresh manager without featureName property","ERROR",b),g.logMetric("UDM-REFRESH-REQUEST-INVALID"),!1;if(0>b)return e.log("UDM Refresh Manager: buyingOptionIndex cannot be less than zero.","ERROR",a.featureName),r("UDM-REFRESH-REQUEST-INVALID",a.featureName),!1;var q=!0;f.each(d.getMandatoryParamsForFeature(a.featureName),
function(b){c.hasOwnProperty(b)||(e.log("UDM Refresh Manager: mandatory param: "+b+" is not present in request data.","ERROR",a.featureName),r("UDM-REFRESH-REQUEST-INVALID",a.featureName),q=!1)});return q}function b(a,c){return null==c||"undefined"===typeof c.asin?(e.log("UDM Refresh Manager: Refresh triggered for a buybox type which does not have the page state","ERROR",a.featureName),r("UDM-REFRESH-REQUEST-INVALID",a.featureName),!1):!0}function l(a,c,b,d){c=x(a,c);a=m(a,b);b={asin:d.asin,merchantId:d.merchantId,
exclusiveMerchantId:d.merchantId};k.isEnabled&&(b.deviceType=d.deviceType);null!=d.offerListingId&&(b.offerListingId=d.offerListingId);null!=d.locale&&(b.language=d.locale);return{gxaParams:f.extend({},y,b,a,c),featureStateToPersist:c}}function m(a,b){var d={},q=v[b];f.each(c.getRegisteredFeatures(b),function(c){c!==a&&f.extend(d,u(q,c,b))});return d}function u(a,b,d){return a&&a.hasOwnProperty(b)?a[b]:c.getDataForFeature(b,d).mandatoryParams}function x(a,b){var c={},e=d.getMandatoryParamsForFeature(a);
f.each(e,function(a){c[a]=b[a]});a=d.getOptionalParamsForFeature(a);f.each(a,function(a){b[a]!==t&&(c[a]=b[a])});return c}function r(a,b){g.logMetric(a);g.logMetricWithSuffix(a,b)}var v={},y={clientId:"retailwebsite",deviceType:"web",showFeatures:"udmRefreshFeatures,deliveryBlock,priceBlockMs3Mir",ie:"UTF8",experienceId:"udmRefreshAjaxExperience"};return{registerFeature:function(a,b,d){return c.registerFeature(a,b,d)},refresh:function(d,f,e){if(!h(d,f,e))return!1;var g=n.getDeliveryBlockPageState(e);
if(!b(d,g))return!1;var k=l(d.featureName,f,e,g);a.fetchContentFromGxa(k.gxaParams).then(function(a){var b=k.featureStateToPersist;n.updatePage(e,a);v.hasOwnProperty(e)||(v[e]={});v[e][d.featureName]=b;r("UDM-REFRESH-REQUEST-SUCCESS",d.featureName);c.getDataForFeature(d.featureName,e).callbacks.successHandler()}).catch(function(a){r("UDM-REFRESH-REQUEST-FAILURE",d.featureName);c.getDataForFeature(d.featureName,e).callbacks.failureHandler()});return!0}}});"use strict";e.when("A").register("udm-refresh-dom-accessor",
function(e){var c=e.$;return{getDeliveryBlockPageState:function(a){a=c('script[data-a-state\x3d\'{"key":"delivery-block-ajax-params-'+a+"\"}']").text();return JSON.parse(a)},updatePage:function(a,e){var d=document.createElement("div");d.innerHTML=e;a=c('script[data-a-state\x3d\'{"key":"delivery-block-ajax-params-'+a+"\"}']").closest('[id$\x3d"AccordionRow"], #buybox, [id^\x3d"newAccordionRow"]');e=d.querySelector("#deliveryBlockSmallMessage");c(a).find("#deliveryBlockSmallMessage").replaceWith(e);
e=d.querySelector("#deliveryBlockMessage");c(a).find("#deliveryBlockMessage").replaceWith(e);d=d.querySelector("#primeBadge-ajax-feature");c(a).find("#priceBadging_feature_div").replaceWith(d);if(1===c("#buyBoxAccordion, #buybox").children().length||a.attr("id").match(/^newAccordionRow/))c("#price #priceblock_ourprice_row #ourprice_shippingmessage #priceBadging_feature_div").replaceWith(d),c("#newOfferShippingMessage_feature_div #ourPrice_availability #priceBadging_feature_div").replaceWith(d),c("#price #priceblock_saleprice_row #saleprice_shippingmessage #priceBadging_feature_div").replaceWith(d),
c("#price #priceblock_dealprice_row #dealprice_shippingmessage #priceBadging_feature_div").replaceWith(d)}}});"use strict";e.when("A").register("udm-metrics-publisher",function(e){function c(a,c){"undefined"!==typeof h.ue&&"undefined"!==typeof h.ue.count&&(null==c?h.ue.count(a,(ue.count(a)||0)+1):h.ue.count(a,c))}return{logMetric:c,logLatency:function(a,e,d){null==d&&(d=(new Date).getTime());c(a,d-e)},logMetricWithSuffix:function(a,e){c(a+"-"+e)}}});"use strict";e.when("A","3p-promise","udm-refresh-gxa-flow-migration-weblab",
"udm-metrics-publisher").register("udm-gxa-handler",function(e,c,a,h){function d(c){return(a.isEnabled?"/gp/product/ajax/udmRefreshAjaxExperience":"/gp/product/ajax")+"?"+Object.keys(c).map(function(a){return a+"\x3d"+c[a]}).join("\x26")}return{fetchContentFromGxa:function(a){var f=d(a),g=(new Date).getTime();return new c(function(a,c){e.get(f,{timeout:"10000",contentType:"application/x-www-form-urlencoded;charset\x3dutf-8",dataType:"html",success:function(b){null==b||0===b.trim().length?(h.logLatency("UDM-GXA-NULL-RESPONSE-LATENCY",
g),c(Error("EMPTY_RESPONSE_ERROR_MESSAGE"))):(h.logLatency("UDM-GXA-CALL-SUCCESS-LATENCY",g),a(b.trim()))},error:function(a){h.logLatency("UDM-GXA-CALL-FAILURE-LATENCY",g);c(a)}})})}}});"use strict";e.register("udm-refresh-gxa-flow-migration-weblab",function(){return{isEnabled:!0}});"use strict";e.register("udm-glow-cip-migration-weblab",function(){return{isEnabled:!1}});"use strict";e.register("udm-amount-refresh",function(){return{isEnabled:!1}})});